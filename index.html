<!-- 전체 파일: 원본 코드(변경 없음) + 로그인/회원가입 기능 추가 -->
<!-- 사용자 원본 시작 -->
<!--
경고: 귀하가 무단 수집하려는 사이트의 핵심 데이터는 본 오픈소스에 포함되지 않습니다. 본 사이트의 무단 소스 코드 데이터 수집(크롤링, 스크래핑 등)행위는 서버 접근 로그에 기기의 IP와 함께 기록됩니다.
허용된 관리자 인터페이스를 제외한 IP가 데이터를 수집하는 행위는 적발 즉시 밴블리온 운영 정책에 따른 IP 유포와 유저 정보 공개 등 상응한 제재가 이루어질 수 있습니다.
-->

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>유피드 밴블리온</title>
  <style>

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #1c1c1c;
      color: #fff;
    }

    /* 헤더 */
    header {
      background-color: #003d80;
      color: white;
      padding: 11px 25px; /* 기존 10px -> 11px (110% 확대) */
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header .logo {
      font-size: 19.8px;
      font-weight: bold;
    }

    header .auth-buttons a {
      color: white;
      text-decoration: none;
      margin-left: 15px;
      font-weight: bold;
      font-size: 15.4px;
      transition: color 0.3s;
    }

    header .auth-buttons a:hover {
      color: #ffcc00;
    }

    /* 공지 텍스트 박스 */
    .notice-box {
      width: 70%;
      margin: 15px auto 0 auto;
      text-align: left;
      font-size: 19.8px;
      font-weight: bold;
      color: #ffae42;
    }

    /* 슬라이더 */
    .slider {
      position: relative;
      width: 70%;
      margin: 10px auto;
      height: 275px; /* 기존 250px -> 275px (110% 확대) */
      overflow: hidden;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    }

    .slides {
      display: flex;
      width: 300%;
      height: 100%;
      transition: transform 0.6s ease-in-out;
    }

    .slides img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .dots {
      text-align: center;
      margin-top: 10px;
    }

    .dot {
      height: 10px;
      width: 10px;
      margin: 0 4px;
      background-color: #bbb;
      border-radius: 50%;
      display: inline-block;
      cursor: pointer;
    }

    .active {
      background-color: #003d80;
    }

    /* 커뮤니티 섹션 */
    .community-section {
      width: 70%;
      margin: 40px auto;
      display: flex;
      justify-content: space-between;
      gap: 20px;
    }

    .community-box {
      background-color: #242424;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
      width: auto;
      max-width: 50%;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    .community-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #ffae42;
    }

    .community-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .community-list li {
      margin: 10px 0;
    }

    .community-list a {
      color: #ddd;
      text-decoration: none;
      font-size: 16px;
      font-weight: normal;
      transition: color 0.3s;
    }

    .community-list a:hover {
      color: #ffae42;
    }

    /* 중앙 세션 */
    .middle-box {
      background-color: #242424;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
      padding: 20px;
      margin-top: 30px;
      flex: 1;
      text-align: center;
      display: flex;
      align-items: flex-start;
      justify-content: center;
    }

    .middle-box span {
      position: relative;
      top: -5px; /* 글씨를 조금 위로 */
      font-size: 16px;
      color: #ddd;
    }
  </style>
</head>
<body>

  <!-- 헤더 -->
  <header>
    <div class="logo">BANBLE LEON</div>
    <div class="auth-buttons">
      <a href="#" id="loginLink">로그인</a>
      <a href="#" id="signupLink">회원가입</a>
    </div>
  </header>

  <!-- 공지 텍스트 박스 -->
  <div class="notice-box" style="font-size:15.4px;">
    오늘의 공지: 새로운 이벤트가 시작되었습니다!
  </div>

  <!-- 슬라이더 -->
  <div class="slider">
    <div class="slides">
      <img src="https://test-resize-image.wishbeen.co.kr/5e608143aa825c93a9dd78f8af521c74.jpg?w=790&q=80" alt="공지1">
      <img src="https://pimg.mk.co.kr/meet/neds/2020/11/image_readtop_2020_1182659_16055986074435325.jpg" alt="공지2">
      <img src="https://celcliptipsprod.s3-ap-northeast-1.amazonaws.com/tips_article_body/4c36/208331/7eb07261d46614eccf78b4ecdc7cd07a" alt="공지3">
    </div>
  </div>
  <div class="dots">
    <span class="dot active"></span>
    <span class="dot"></span>
    <span class="dot"></span>
  </div>

  <!-- 커뮤니티 섹션 -->
  <div class="community-section">
    <!-- 왼쪽 A~E -->
    <div class="community-box">
      <div class="community-title">왼쪽 커뮤니티</div>
      <ul class="community-list">
        <li><a href="#">커뮤니티 A</a></li>
        <li><a href="#">커뮤니티 B</a></li>
        <li><a href="#">커뮤니티 C</a></li>
        <li><a href="#">커뮤니티 D</a></li>
        <li><a href="#">커뮤니티 E</a></li>
      </ul>
    </div>

    <!-- 중앙 세션 -->
    <div class="middle-box">
      <span>중앙 세션 (추가 버튼 영역)</span>
    </div>

    <!-- 오른쪽 F~J -->
    <div class="community-box">
      <div class="community-title">오른쪽 커뮤니티</div>
      <ul class="community-list">
        <li><a href="#">커뮤니티 F</a></li>
        <li><a href="#">커뮤니티 G</a></li>
        <li><a href="#">커뮤니티 H</a></li>
        <li><a href="#">커뮤니티 I</a></li>
        <li><a href="#">커뮤니티 J</a></li>
      </ul>
    </div>
  </div>

  <script>
    let index = 0;
    const slides = document.querySelector(".slides");
    const dots = document.querySelectorAll(".dot");

    function showSlide(n) {
      index = n;
      slides.style.transform = `translateX(${-n * 100}%)`;
      dots.forEach(dot => dot.classList.remove("active"));
      dots[n].classList.add("active");
    }

    function autoSlide() {
      index = (index + 1) % 3;
      showSlide(index);
    }

    dots.forEach((dot, i) => {
      dot.addEventListener("click", () => showSlide(i));
    });

    setInterval(autoSlide, 4000);
  </script>

  <!-- 사이트 푸터 -->
  <footer style="background:#111; color:#ccc; font-size:12px; padding:20px; text-align:center; line-height:1.5;">
    <div>
      <a href="#" style="color:#ccc; text-decoration:none; margin:0 4.5px;">이용약관</a> |
      <a href="#" style="color:#ccc; text-decoration:none; margin:0 4.5px;">개인정보 처리방침</a> |
      <a href="#" style="color:#ccc; text-decoration:none; margin:0 4.5px;">유피드 자산 데이터 서버 지침</a> |
      <a href="#" style="color:#ccc; text-decoration:none; margin:0 4.5px;">밴블리온 운영부 고지 사항</a> |
      <a href="#" style="color:#ccc; text-decoration:none; margin:0 4.5px;">커뮤니티 가이드라인</a>
    </div>
    <div style="margin-top:9px;">
      유피드는 밴블리온 사 프로그램 개발 부서 "에너자이저"의 공식 인트라넷 플랫폼으로, 모든 사이트 내 정보는 사이트 자산사의 목적에 한해 제한되고 관리될 수 있습니다.
    </div>
    <div style="margin-top:9px;">
      경기도 수원시 밴블리온 수원 지부 미공개 위치<br>
      help@upid.org | 오픈 소스 라이선스<br>
      ©UPID Foundation.
    </div>
  </footer>

  <link rel="icon" type="image/png" href="favicon.png">
<!-- 사용자 원본 끝 -->

<!-- 여기에부터 로그인/회원가입 관련 추가 코드 (원본 코드는 수정하지 않음) -->
<!-- 모달 HTML (UI: 사용자가 제공한 모달 기반으로 추가) -->
<!-- 로그인 모달 -->
<div id="loginModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="loginTitle">
  <div class="modal-content" role="document">
    <span class="modal-close" onclick="closeModal('loginModal')">&times;</span>
    <h2 id="loginTitle">로그인</h2>
    <input type="email" id="loginEmail" placeholder="이메일" autocomplete="email">
    <input type="password" id="loginPass" placeholder="비밀번호" autocomplete="current-password">
    <div id="loginError" style="color:#ff6b6b; font-size:13px; min-height:18px; margin-top:6px;"></div>
    <button id="loginSubmit">로그인</button>
  </div>
</div>

<!-- 회원가입 모달 -->
<div id="signupModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="signupTitle">
  <div class="modal-content" role="document">
    <span class="modal-close" onclick="closeModal('signupModal')">&times;</span>
    <h2 id="signupTitle">회원가입</h2>
    <input type="text" id="signupNickname" placeholder="닉네임" autocomplete="name">
    <input type="email" id="signupEmail" placeholder="이메일" autocomplete="email">
    <input type="password" id="signupPass" placeholder="비밀번호" autocomplete="new-password">
    <div id="signupError" style="color:#ff6b6b; font-size:13px; min-height:18px; margin-top:6px;"></div>
    <button id="signupSubmit">회원가입</button>
  </div>
</div>

<!-- 추가 모달 스타일 (원본 스타일과 충돌 최소화) -->
<style>
  /* 모달 공통 (추가된 부분) */
  .modal {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.6);
    justify-content: center;
    align-items: center;
  }

  .modal[aria-hidden="false"] {
    display: flex;
  }

  .modal-content {
    background-color: #1c1c1c;
    padding: 20px;
    border-radius: 10px;
    color: white;
    width: 320px;
    box-shadow: 0 6px 24px rgba(0,0,0,0.6);
  }

  .modal-content h2 {
    margin-top: 0;
  }

  .modal-content input {
    width: 100%;
    margin: 6px 0;
    padding: 10px;
    border-radius: 6px;
    border: 1px solid #333;
    background: #0f0f0f;
    color: #fff;
    box-sizing: border-box;
  }

  .modal-content button {
    margin-top: 10px;
    padding: 10px 12px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    background: #003d80;
    color: #fff;
    width: 100%;
  }

  .modal-close {
    float: right;
    cursor: pointer;
    font-size: 18px;
    margin-top: -5px;
  }

  /* 로그인 후 표시용 버튼 스타일 (헤더에 추가할 때 사용) */
  .header-user {
    color: white;
    margin-left: 10px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  .header-user button {
    background: transparent;
    border: 1px solid rgba(255,255,255,0.18);
    padding: 6px 8px;
    border-radius: 6px;
    color: #fff;
    cursor: pointer;
    font-weight: bold;
  }
</style>

<!-- 로그인/회원가입 동작 스크립트 (Firebase 사용) -->
<!-- 주의: 아래 firebaseConfig를 본인 프로젝트 설정으로 바꿔주세요. -->
<script type="module">
  // -----------------------
  // Firebase v10+ modular import via CDN (ES module)
  // Replace firebaseConfig with your project's config.
  // Steps you must do in Firebase Console:
  // 1) Authentication -> Sign-in method -> Enable Email/Password
  // 2) Firestore -> create database (mode: 적절히 선택)
  // 3) Add web app and copy firebaseConfig
  // -----------------------

  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import {
    getAuth,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
    signOut,
    onAuthStateChanged,
    updateProfile
  } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
  import {
    getFirestore,
    doc,
    setDoc,
    getDoc,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

  // --------- REPLACE WITH YOUR FIREBASE CONFIG ----------
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };
  // -----------------------------------------------------

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Helper: DOM elements
  const loginLink = document.getElementById('loginLink');
  const signupLink = document.getElementById('signupLink');

  const loginModal = document.getElementById('loginModal');
  const signupModal = document.getElementById('signupModal');

  const loginEmail = document.getElementById('loginEmail');
  const loginPass = document.getElementById('loginPass');
  const loginSubmit = document.getElementById('loginSubmit');
  const loginError = document.getElementById('loginError');

  const signupNickname = document.getElementById('signupNickname');
  const signupEmail = document.getElementById('signupEmail');
  const signupPass = document.getElementById('signupPass');
  const signupSubmit = document.getElementById('signupSubmit');
  const signupError = document.getElementById('signupError');

  // Open modals
  loginLink.addEventListener('click', (e) => {
    e.preventDefault();
    openModal('loginModal');
  });
  signupLink.addEventListener('click', (e) => {
    e.preventDefault();
    openModal('signupModal');
  });

  // Modal functions
  window.openModal = function(id) {
    const el = document.getElementById(id);
    if (!el) return;
    el.setAttribute('aria-hidden', 'false');
    // focus first input
    const firstInput = el.querySelector('input');
    if (firstInput) firstInput.focus();
  }
  window.closeModal = function(id) {
    const el = document.getElementById(id);
    if (!el) return;
    el.setAttribute('aria-hidden', 'true');
    // clear error messages
    if (id === 'loginModal') loginError.textContent = '';
    if (id === 'signupModal') signupError.textContent = '';
  }

  // Click outside to close
  document.addEventListener('click', (e) => {
    ['loginModal','signupModal'].forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;
      if (el.getAttribute('aria-hidden') === 'false' && e.target === el) {
        closeModal(id);
      }
    });
  });

  // Signup handler
  signupSubmit.addEventListener('click', async () => {
    signupError.textContent = '';
    const nick = signupNickname.value.trim();
    const email = signupEmail.value.trim();
    const pass = signupPass.value;

    if (!nick) { signupError.textContent = '닉네임을 입력해주세요.'; return; }
    if (!validateEmail(email)) { signupError.textContent = '유효한 이메일을 입력해주세요.'; return; }
    if (pass.length < 6) { signupError.textContent = '비밀번호는 최소 6자 이상이어야 합니다.'; return; }

    signupSubmit.disabled = true;
    signupSubmit.textContent = '가입중...';

    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, pass);
      const user = userCredential.user;

      // Update displayName in Auth profile (optional)
      await updateProfile(user, { displayName: nick }).catch(()=>{ /* ignore */ });

      // Save user profile to Firestore
      const userRef = doc(db, 'users', user.uid);
      await setDoc(userRef, {
        nickname: nick,
        email: email,
        createdAt: serverTimestamp()
      });

      // close modal
      closeModal('signupModal');
    } catch (err) {
      console.error(err);
      signupError.textContent = firebaseErrorMessage(err);
    } finally {
      signupSubmit.disabled = false;
      signupSubmit.textContent = '회원가입';
    }
  });

  // Login handler
  loginSubmit.addEventListener('click', async () => {
    loginError.textContent = '';
    const email = loginEmail.value.trim();
    const pass = loginPass.value;

    if (!validateEmail(email)) { loginError.textContent = '유효한 이메일을 입력해주세요.'; return; }
    if (pass.length < 6) { loginError.textContent = '비밀번호는 최소 6자 이상이어야 합니다.'; return; }

    loginSubmit.disabled = true;
    loginSubmit.textContent = '로그인중...';

    try {
      const userCredential = await signInWithEmailAndPassword(auth, email, pass);
      // 로그인 성공하면 Firebase가 상태를 유지합니다.
      closeModal('loginModal');
    } catch (err) {
      console.error(err);
      loginError.textContent = firebaseErrorMessage(err);
    } finally {
      loginSubmit.disabled = false;
      loginSubmit.textContent = '로그인';
    }
  });

  // Logout function (will be rendered in header by updateUIAfterAuth)
  async function handleLogout() {
    try {
      await signOut(auth);
    } catch (err) {
      console.error('로그아웃 실패', err);
      alert('로그아웃에 실패했습니다.');
    }
  }

  // Observe auth state and update header accordingly
  onAuthStateChanged(auth, async (user) => {
    const authButtons = document.querySelector('.auth-buttons');
    if (!authButtons) return;

    // Clear current content but do not touch other header parts
    // We'll replace only auth-buttons innerHTML (this is the only header part related to auth)
    if (user) {
      // Get nickname from profile or Firestore
      let nickname = user.displayName || '';
      if (!nickname) {
        try {
          const udoc = await getDoc(doc(db, 'users', user.uid));
          if (udoc.exists()) {
            const ud = udoc.data();
            nickname = ud.nickname || nickname || user.email;
          }
        } catch (e) {
          console.error('profile fetch failed', e);
        }
      }
      // Replace auth-buttons content with user info + logout
      authButtons.innerHTML = `
        <span class="header-user" title="로그인 상태">
          <strong style="color:#fff">${escapeHtml(nickname || (user.email || '사용자'))}</strong>
          <button id="logoutBtn">로그아웃</button>
        </span>
      `;
      const logoutBtn = document.getElementById('logoutBtn');
      if (logoutBtn) logoutBtn.addEventListener('click', handleLogout);
    } else {
      // Not logged in — restore original login/signup links (note: original elements existed with IDs)
      authButtons.innerHTML = `
        <a href="#" id="loginLink">로그인</a>
        <a href="#" id="signupLink">회원가입</a>
      `;
      // Reattach listeners for the re-created links
      const newLogin = document.getElementById('loginLink');
      const newSignup = document.getElementById('signupLink');
      if (newLogin) newLogin.addEventListener('click', (e)=>{ e.preventDefault(); openModal('loginModal'); });
      if (newSignup) newSignup.addEventListener('click', (e)=>{ e.preventDefault(); openModal('signupModal'); });
    }
  });

  // Basic helpers
  function validateEmail(email) {
    // simple regex
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  }

  function firebaseErrorMessage(err) {
    if (!err || !err.code) return '알 수 없는 오류가 발생했습니다.';
    switch (err.code) {
      case 'auth/email-already-in-use': return '이미 사용 중인 이메일입니다.';
      case 'auth/invalid-email': return '유효하지 않은 이메일입니다.';
      case 'auth/weak-password': return '비밀번호가 너무 약합니다.';
      case 'auth/wrong-password': return '비밀번호가 틀렸습니다.';
      case 'auth/user-not-found': return '사용자를 찾을 수 없습니다.';
      case 'auth/too-many-requests': return '요청이 너무 많습니다. 잠시 후 다시 시도하세요.';
      default: return (err.message || '오류가 발생했습니다.');
    }
  }

  // Simple HTML escape for display safety
  function escapeHtml(unsafe) {
    return String(unsafe)
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }

  // END of module
</script>

<!-- 끝: 로그인/회원가입 추가 코드 -->
</body>
</html>
